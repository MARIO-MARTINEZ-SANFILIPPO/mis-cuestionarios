<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cuestionario de Repaso: DevOps</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript">document.oncontextmenu = function(){return false;}</script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Source+Code+Pro:wght@400;600&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['Source Code Pro', 'monospace'],
                    },
                },
            },
        }
    </script>
    <style>
        .draggable-item { cursor: grab; }
        .draggable-item:active { cursor: grabbing; }
        .drop-zone { border-style: dashed; }
        .drag-over { background-color: #e0f2fe; }
        .dark .drag-over { background-color: #374151; }
        .correct-answer { background-color: #dcfce7 !important; border-color: #4ade80 !important; }
        .dark .correct-answer { background-color: #166534 !important; }
        .incorrect-answer { background-color: #fee2e2 !important; border-color: #f87171 !important; }
        .dark .incorrect-answer { background-color: #991b1b !important; }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 font-sans transition-colors duration-300">

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-4xl">
        
        <header class="flex justify-between items-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 dark:text-white">Quiz de DevOps</h1>
            <div class="flex items-center">
                <span class="text-sm mr-2">‚òÄÔ∏è</span>
                <label for="dark-mode-toggle" class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="dark-mode-toggle" class="sr-only peer">
                    <div class="w-11 h-6 bg-gray-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                </label>
                <span class="text-sm ml-2">üåô</span>
            </div>
        </header>

        <div id="quiz-container" class="bg-white dark:bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-lg">
            <div class="flex justify-between items-center mb-6">
                 <button id="start-btn" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg text-sm transition-colors duration-300">Ir al Principio</button>
                 <div id="progress-indicator" class="text-sm font-semibold text-gray-600 dark:text-gray-400"></div>
                 <button id="end-btn" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg text-sm transition-colors duration-300">Ir al Final</button>
            </div>
            <div id="question-container">
                <!-- Las preguntas se cargar√°n aqu√≠ -->
            </div>
            <div id="feedback-container" class="mt-4"></div>
            <div class="mt-8 flex justify-between items-center">
                <button id="prev-btn" class="bg-gray-300 hover:bg-gray-400 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300 disabled:opacity-50 disabled:cursor-not-allowed">Anterior</button>
                <button id="submit-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300">Finalizar Quiz</button>
                <button id="next-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300">Siguiente</button>
            </div>
        </div>

    </div>

    <div id="results-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6 sm:p-8">
            <h2 class="text-3xl font-bold text-center mb-4 text-gray-900 dark:text-white">Resultados del Quiz</h2>
            <div id="score-container" class="text-center text-2xl font-semibold mb-6"></div>
            <div id="answers-review-container" class="space-y-4"></div>
            <div class="text-center mt-8">
                <button id="restart-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg transition-colors duration-300">Intentar de Nuevo</button>
            </div>
        </div>
    </div>

    <script>
        const quizData = [
            // DevOps Culture & Principles
            { type: 'multiple-choice', question: 'Seg√∫n Donovan Brown, DevOps es la uni√≥n de Personas, Procesos y...', options: ['Plataformas', 'Productos', 'Proyectos', 'Pr√°cticas'], answer: 'Productos' },
            { type: 'multiple-choice', question: '¬øCu√°l es el conflicto central que DevOps busca resolver?', options: ['Desarrollo vs. QA', 'Desarrollo vs. Operaciones', 'Negocio vs. TI', 'Seguridad vs. Desarrollo'], answer: 'Desarrollo vs. Operaciones' },
            { type: 'multiple-choice', question: 'El concepto de "Kaizen" o mejora continua, es un pilar fundamental de:', options: ['ITIL', 'Manifiesto √Ågil', 'Sistema de Producci√≥n Toyota (LEAN)', 'Scrum'], answer: 'Sistema de Producci√≥n Toyota (LEAN)' },
            { type: 'multiple-choice', question: '¬øQu√© significa "CI" en el contexto de DevOps?', options: ['Integraci√≥n Constante', 'Implementaci√≥n Continua', 'Integraci√≥n Continua', 'Infraestructura Continua'], answer: 'Integraci√≥n Continua' },
            { type: 'multiple-choice', question: 'La pr√°ctica de gestionar y aprovisionar infraestructura a trav√©s de c√≥digo se conoce como:', options: ['CD', 'CI', 'IaC', 'VM'], answer: 'IaC' },
            
            // Git
            { type: 'multiple-choice', question: '¬øQu√© comando de Git se utiliza para crear una nueva rama y cambiar a ella inmediatamente?', options: ['git branch <nombre>', 'git checkout -b <nombre>', 'git switch <nombre>', 'git new-branch <nombre>'], answer: 'git checkout -b <nombre>' },
            { type: 'multiple-choice', question: '¬øCu√°l es el prop√≥sito del comando `git pull`?', options: ['Subir cambios al repositorio remoto', 'Descargar cambios del remoto y fusionarlos', 'Ver el estado de los archivos', 'Crear un nuevo commit'], answer: 'Descargar cambios del remoto y fusionarlos' },
            { type: 'multiple-choice', question: 'El √°rea donde Git almacena los cambios que ser√°n incluidos en el pr√≥ximo commit se llama:', options: ['Working Directory', 'Stash', 'Staging Area (Index)', 'Remote Repository'], answer: 'Staging Area (Index)' },
            { type: 'multiple-choice', question: '¬øQu√© comando a√±ade todos los archivos modificados al Staging Area?', options: ['git add .', 'git add *', 'git add --all', 'Todas son correctas'], answer: 'Todas son correctas' },
            { type: 'multiple-choice', question: '¬øQu√© comando usar√≠as para fusionar la rama "feature" en tu rama actual "main"?', options: ['git merge feature', 'git commit feature', 'git push feature', 'git branch feature'], answer: 'git merge feature' },
            
            // Python
            { type: 'multiple-choice', question: 'En Python, ¬øqu√© m√©todo se usa para a√±adir un elemento al final de una lista?', options: ['.insert()', '.add()', '.extend()', '.append()'], answer: '.append()' },
            { type: 'multiple-choice', question: '¬øCu√°l es la principal caracter√≠stica de una tupla en Python?', options: ['Es mutable', 'Es inmutable (no se puede modificar)', 'Solo puede contener n√∫meros', 'No mantiene un orden'], answer: 'Es inmutable (no se puede modificar)' },
            { type: 'multiple-choice', question: 'Para ejecutar un comando del sistema operativo en un script de Python, ¬øqu√© m√≥dulo es com√∫nmente utilizado?', options: ['math', 'requests', 'os o subprocess', 'json'], answer: 'os o subprocess' },
            { type: 'multiple-choice', question: '¬øC√≥mo imprimes cada clave de un diccionario llamado `mi_dict`?', options: ['for clave in mi_dict.keys():', 'for clave in mi_dict.values():', 'for clave in mi_dict:', 'for clave in mi_dict.items():'], answer: 'for clave in mi_dict:' },
            { type: 'multiple-choice', question: '¬øQu√© palabra clave se utiliza en Python para definir una funci√≥n?', options: ['function', 'def', 'fun', 'define'], answer: 'def' },

            // Docker
            { type: 'multiple-choice', question: '¬øQu√© es una Imagen de Docker?', options: ['Un contenedor en ejecuci√≥n', 'Un script de instalaci√≥n', 'Una plantilla de solo lectura para crear contenedores', 'Un volumen de datos'], answer: 'Una plantilla de solo lectura para crear contenedores' },
            { type: 'multiple-choice', question: '¬øQu√© comando de Docker lista todos los contenedores, incluyendo los detenidos?', options: ['docker ps', 'docker images', 'docker ps -a', 'docker list all'], answer: 'docker ps -a' },
            { type: 'multiple-choice', question: 'En un `Dockerfile`, ¬øqu√© instrucci√≥n se usa para copiar archivos desde el host al contenedor?', options: ['ADD', 'COPY', 'MOVE', 'INSERT'], answer: 'COPY' },
            { type: 'multiple-choice', question: '¬øQu√© instrucci√≥n expone el puerto 5000 en un `Dockerfile`?', options: ['PORT 5000', 'OPEN 5000', 'EXPOSE 5000', 'LISTEN 5000'], answer: 'EXPOSE 5000' },
            { type: 'multiple-choice', question: '¬øQu√© comando abre una terminal interactiva en un contenedor llamado "mi_app"?', options: ['docker exec -it mi_app bash', 'docker --interactive mi_app', 'docker attach mi_app sh', 'docker run mi_app'], answer: 'docker exec -it mi_app bash' },

            // Matching Concepts
            { type: 'matching', question: 'Une cada comando de Git con su funci√≥n.', pairs: { 'git commit': 'Guarda los cambios del Staging Area en el historial local.', 'git push': 'Env√≠a los commits locales a un repositorio remoto.', 'git status': 'Muestra el estado de los archivos en el directorio de trabajo.', 'git merge': 'Combina el historial de diferentes ramas en una sola.' } },
            { type: 'matching', question: 'Relaciona cada instrucci√≥n de Dockerfile con su prop√≥sito.', pairs: { 'FROM': 'Especifica la imagen base para la construcci√≥n.', 'RUN': 'Ejecuta un comando y crea una nueva capa en la imagen.', 'WORKDIR': 'Establece el directorio de trabajo para las instrucciones siguientes.', 'CMD': 'Define el comando por defecto a ejecutar al iniciar el contenedor.' } },
            
            // More questions
            { type: 'multiple-choice', question: '¬øQu√© es un "anti-patr√≥n" en DevOps?', options: ['Una herramienta de seguridad', 'Una pr√°ctica que va en contra de los principios de DevOps, como los despliegues manuales', 'Un tipo de prueba automatizada', 'Una metodolog√≠a de gesti√≥n de proyectos'], answer: 'Una pr√°ctica que va en contra de los principios de DevOps, como los despliegues manuales' },
            { type: 'multiple-choice', question: 'La charla "10+ Deploys Per Day" de Flickr en 2009 es considerada un hito porque:', options: ['Introdujo el lenguaje Python', 'Demostr√≥ que la velocidad y la estabilidad no son mutuamente excluyentes', 'Cre√≥ el primer contenedor', 'Defini√≥ el Manifiesto √Ågil'], answer: 'Demostr√≥ que la velocidad y la estabilidad no son mutuamente excluyentes' },
            { type: 'multiple-choice', question: '¬øQu√© comando de Git te permite ver el historial de commits de tu repositorio?', options: ['git status', 'git diff', 'git log', 'git show'], answer: 'git log' },
            { type: 'multiple-choice', question: 'En Python, ¬øc√≥mo se define un diccionario vac√≠o?', options: ['list()', '()', '{}', 'dict[]'], answer: '{}' },
            { type: 'multiple-choice', question: '¬øPara qu√© sirve el comando `docker rm`?', options: ['Para eliminar una imagen', 'Para reiniciar un contenedor', 'Para eliminar uno o m√°s contenedores detenidos', 'Para renombrar un contenedor'], answer: 'Para eliminar uno o m√°s contenedores detenidos' },
            { type: 'multiple-choice', question: '¬øCu√°l de estas opciones NO es un beneficio directo de adoptar DevOps?', options: ['Mayor calidad y confiabilidad', 'Entrega m√°s r√°pida de proyectos', 'Eliminaci√≥n completa de la necesidad de un equipo de operaciones', 'Mayor colaboraci√≥n y comunicaci√≥n'], answer: 'Eliminaci√≥n completa de la necesidad de un equipo de operaciones' },
            { type: 'multiple-choice', question: '¬øQu√© comando de Git descarta los cambios en un archivo espec√≠fico del directorio de trabajo?', options: ['git checkout -- <file>', 'git reset <file>', 'git revert <file>', 'git clean <file>'], answer: 'git checkout -- <file>' },
            { type: 'multiple-choice', question: 'En Python, ¬øqu√© hace el m√©todo `.keys()` en un diccionario?', options: ['Devuelve una lista de todos los valores', 'Devuelve una lista de todas las claves', 'Elimina una clave espec√≠fica', 'A√±ade una nueva clave'], answer: 'Devuelve una lista de todas las claves' },
            { type: 'multiple-choice', question: '¬øQu√© es Docker Hub?', options: ['La interfaz de l√≠nea de comandos de Docker', 'Un registro p√∫blico de im√°genes de Docker', 'El motor que ejecuta los contenedores', 'Un archivo de configuraci√≥n de Docker'], answer: 'Un registro p√∫blico de im√°genes de Docker' },
            { type: 'multiple-choice', question: 'En un Dockerfile, ¬øqu√© instrucci√≥n usar√≠as para instalar `git` usando `apt-get`?', options: ['CMD apt-get install -y git', 'RUN apt-get update && apt-get install -y git', 'EXEC apt-get install -y git', 'DO apt-get install -y git'], answer: 'RUN apt-get update && apt-get install -y git' },
            { type: 'multiple-choice', question: '¬øQu√© significa que Git es un sistema de control de versiones "distribuido"?', options: ['Que solo funciona en la nube', 'Que cada desarrollador tiene una copia completa del historial del repositorio', 'Que necesita un servidor central para funcionar', 'Que los archivos se guardan en m√∫ltiples servidores'], answer: 'Que cada desarrollador tiene una copia completa del historial del repositorio' },
            { type: 'multiple-choice', question: '¬øCu√°l es el prop√≥sito de la instrucci√≥n `LABEL maintainer` en un Dockerfile?', options: ['Define el usuario que ejecutar√° la aplicaci√≥n', 'Especifica el autor o mantenedor de la imagen', 'Instala paquetes de mantenimiento', 'Limita los recursos del contenedor'], answer: 'Especifica el autor o mantenedor de la imagen' },
            { type: 'multiple-choice', question: 'En Python, ¬øc√≥mo se importa la librer√≠a `os`?', options: ['include os', 'require os', 'import os', 'use os'], answer: 'import os' },
            { type: 'multiple-choice', question: '¬øQu√© comando de Docker te permite ver los logs de un contenedor en ejecuci√≥n?', options: ['docker info', 'docker inspect', 'docker logs', 'docker stats'], answer: 'docker logs' },
            { type: 'multiple-choice', question: 'El concepto "Just in Time" est√° asociado principalmente con:', options: ['Docker', 'Git', 'El Manifiesto √Ågil', 'El Sistema de Producci√≥n Toyota (LEAN)'], answer: 'El Sistema de Producci√≥n Toyota (LEAN)' },
            { type: 'multiple-choice', question: '¬øQu√© comando de Git usar√≠as para guardar temporalmente tus cambios no comiteados sin crear un commit?', options: ['git save', 'git hold', 'git stash', 'git store'], answer: 'git stash' },
            { type: 'multiple-choice', question: '¬øQu√© es un "volumen" en Docker?', options: ['El tama√±o de una imagen', 'Un mecanismo para persistir datos generados por y usados en contenedores', 'La cantidad de RAM asignada a un contenedor', 'Una red virtual de Docker'], answer: 'Un mecanismo para persistir datos generados por y usados en contenedores' },
            { type: 'multiple-choice', question: '¬øCu√°l es el objetivo principal de la fase de "Monitoreo y Feedback" en el ciclo de DevOps?', options: ['Desplegar nuevas versiones', 'Escribir c√≥digo', 'Recopilar datos del rendimiento en producci√≥n para informar futuras mejoras', 'Realizar pruebas de seguridad'], answer: 'Recopilar datos del rendimiento en producci√≥n para informar futuras mejoras' },
        ];

        let shuffledQuizData = [];
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const questionContainer = document.getElementById('question-container');
        const feedbackContainer = document.getElementById('feedback-container');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const submitBtn = document.getElementById('submit-btn');
        const startBtn = document.getElementById('start-btn');
        const endBtn = document.getElementById('end-btn');
        const progressIndicator = document.getElementById('progress-indicator');
        const resultsModal = document.getElementById('results-modal');
        const scoreContainer = document.getElementById('score-container');
        const answersReviewContainer = document.getElementById('answers-review-container');
        const restartBtn = document.getElementById('restart-btn');
        let currentQuestionIndex = 0;
        let userAnswers = [];

        darkModeToggle.addEventListener('change', () => {
            document.documentElement.classList.toggle('dark', darkModeToggle.checked);
            localStorage.setItem('darkMode', darkModeToggle.checked ? 'enabled' : 'disabled');
        });

        if (localStorage.getItem('darkMode') === 'enabled') {
            document.documentElement.classList.add('dark');
            darkModeToggle.checked = true;
        }
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function startQuiz() {
            shuffledQuizData = [...quizData];
            shuffleArray(shuffledQuizData);
            userAnswers = new Array(shuffledQuizData.length).fill(null);
            currentQuestionIndex = 0;
            resultsModal.classList.add('hidden');
            resultsModal.classList.remove('flex');
            renderQuestion();
        }

        function renderQuestion() {
            const questionData = shuffledQuizData[currentQuestionIndex];
            feedbackContainer.innerHTML = '';
            let html = `<h2 class="text-2xl font-bold mb-6">${currentQuestionIndex + 1}. ${questionData.question}</h2>`;

            if (questionData.type === 'multiple-choice') {
                html += `<div class="space-y-3" id="options-container">`;
                questionData.options.forEach(option => {
                    html += `
                        <label class="flex items-center p-4 border-2 dark:border-gray-600 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200">
                            <input type="radio" name="option" value="${option}" class="form-radio h-5 w-5 text-blue-600 focus:ring-blue-500">
                            <span class="ml-4 text-lg">${option}</span>
                        </label>
                    `;
                });
                html += `</div>`;
            } else if (questionData.type === 'matching') {
                const concepts = Object.keys(questionData.pairs).sort(() => Math.random() - 0.5);
                const descriptions = Object.values(questionData.pairs).sort(() => Math.random() - 0.5);
                
                html += `<div class="grid grid-cols-1 md:grid-cols-2 gap-6">`;
                html += `<div id="concepts-container" class="space-y-3">`;
                concepts.forEach((concept, index) => {
                    html += `<div id="concept-${index}" draggable="true" class="draggable-item p-3 bg-blue-100 dark:bg-blue-900 border border-blue-300 dark:border-blue-700 rounded-lg">${concept}</div>`;
                });
                html += `</div>`;

                html += `<div class="space-y-3">`;
                descriptions.forEach((desc, index) => {
                    html += `
                        <div class="flex items-center h-16">
                            <div id="drop-zone-${index}" class="drop-zone w-2/5 h-full border-2 dark:border-gray-500 rounded-lg flex items-center justify-center p-2 text-sm text-gray-500">Arrastra aqu√≠</div>
                            <div class="w-3/5 pl-3">${desc}</div>
                        </div>
                    `;
                });
                html += `</div></div>`;
                html += `<button id="check-matching-btn" class="mt-4 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg">Verificar</button>`;
            }

            questionContainer.innerHTML = html;
            updateButtons();
            restoreStateAndAttachListeners();
        }
        
        function restoreStateAndAttachListeners() {
            const questionData = shuffledQuizData[currentQuestionIndex];
            const savedAnswer = userAnswers[currentQuestionIndex];

            if (savedAnswer !== null) {
                if (questionData.type === 'multiple-choice') {
                    const selectedRadio = document.querySelector(`input[name="option"][value="${savedAnswer}"]`);
                    if (selectedRadio) {
                        selectedRadio.checked = true;
                        handleMultipleChoiceSelection(selectedRadio, false); // false to not re-save
                    }
                } else if (questionData.type === 'matching') {
                    const conceptsContainer = document.getElementById('concepts-container');
                    const descriptionToZoneMap = new Map();
                    document.querySelectorAll('.drop-zone').forEach(zone => {
                        descriptionToZoneMap.set(zone.nextElementSibling.textContent, zone);
                    });
                    
                    const tempDiv = document.createElement('div');
                    conceptsContainer.querySelectorAll('.draggable-item').forEach(el => tempDiv.appendChild(el));

                    for (const [concept, description] of Object.entries(savedAnswer)) {
                        const dropZone = descriptionToZoneMap.get(description);
                        const draggableElement = Array.from(tempDiv.children).find(c => c.textContent === concept);
                        if (dropZone && draggableElement) {
                            dropZone.innerHTML = '';
                            dropZone.appendChild(draggableElement);
                        }
                    }
                    
                    Array.from(tempDiv.children).forEach(child => conceptsContainer.appendChild(child));
                    
                    handleMatchingCheck(false); // false to not re-save
                }
            } else {
                 if (questionData.type === 'multiple-choice') {
                    document.querySelectorAll('input[name="option"]').forEach(input => {
                        input.addEventListener('change', (e) => handleMultipleChoiceSelection(e.target));
                    });
                } else if (questionData.type === 'matching') {
                    setupDragAndDrop();
                    document.getElementById('check-matching-btn').addEventListener('click', () => handleMatchingCheck());
                }
            }
        }

        function handleMultipleChoiceSelection(selectedInput, saveAnswer = true) {
            if (saveAnswer) userAnswers[currentQuestionIndex] = selectedInput.value;
            const questionData = shuffledQuizData[currentQuestionIndex];
            const isCorrect = selectedInput.value === questionData.answer;

            document.querySelectorAll('#options-container label').forEach(label => {
                const input = label.querySelector('input');
                input.disabled = true;
                if (input.value === questionData.answer) {
                    label.classList.add('correct-answer');
                } else if (input.checked) {
                    label.classList.add('incorrect-answer');
                }
            });
            
            feedbackContainer.innerHTML = `
                <div class="mt-4 p-4 rounded-lg ${isCorrect ? 'bg-green-100 dark:bg-green-900/50' : 'bg-red-100 dark:bg-red-900/50'}">
                    <p class="font-bold">${isCorrect ? '¬°Correcto!' : 'Incorrecto.'} La respuesta correcta es: <strong>${questionData.answer}</strong></p>
                </div>
            `;
        }

        function setupDragAndDrop() {
            const draggables = document.querySelectorAll('.draggable-item');
            const dropZones = document.querySelectorAll('.drop-zone');
            
            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', e => e.dataTransfer.setData('text/plain', e.target.id));
            });

            dropZones.forEach(zone => {
                zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('drag-over'); });
                zone.addEventListener('dragleave', () => zone.classList.remove('drag-over'));
                zone.addEventListener('drop', e => {
                    e.preventDefault();
                    zone.classList.remove('drag-over');
                    const draggedId = e.dataTransfer.getData('text/plain');
                    const draggedElement = document.getElementById(draggedId);
                    if (zone.children.length > 0) {
                        document.getElementById('concepts-container').appendChild(zone.children[0]);
                    }
                    zone.innerHTML = '';
                    zone.appendChild(draggedElement);
                });
            });
        }

        function handleMatchingCheck(saveAnswer = true) {
            const questionData = shuffledQuizData[currentQuestionIndex];
            const dropZones = document.querySelectorAll('.drop-zone');
            const currentAnswers = {};
            let correctMatches = 0;
            
            dropZones.forEach(zone => {
                const conceptEl = zone.querySelector('.draggable-item');
                if (conceptEl) {
                    const concept = conceptEl.textContent;
                    const description = zone.nextElementSibling.textContent;
                    currentAnswers[concept] = description;
                    if (questionData.pairs[concept] === description) {
                        correctMatches++;
                        zone.parentElement.classList.add('correct-answer');
                    } else {
                        zone.parentElement.classList.add('incorrect-answer');
                    }
                }
            });
            if(saveAnswer) userAnswers[currentQuestionIndex] = currentAnswers;
            
            const isAllCorrect = correctMatches === Object.keys(questionData.pairs).length;
            feedbackContainer.innerHTML = `
                <div class="mt-4 p-4 rounded-lg ${isAllCorrect ? 'bg-green-100 dark:bg-green-900/50' : 'bg-red-100 dark:bg-red-900/50'}">
                    <p class="font-bold">${isAllCorrect ? '¬°Perfecto!' : `Lograste ${correctMatches} de ${Object.keys(questionData.pairs).length} asociaciones correctas.`}</p>
                </div>
            `;
            document.getElementById('check-matching-btn').disabled = true;
            document.querySelectorAll('.draggable-item').forEach(item => item.draggable = false);
        }

        function updateButtons() {
            prevBtn.disabled = currentQuestionIndex === 0;
            nextBtn.disabled = currentQuestionIndex === shuffledQuizData.length - 1;
            progressIndicator.textContent = `Pregunta ${currentQuestionIndex + 1} de ${shuffledQuizData.length}`;
        }

        function showResults() {
            let score = 0;
            let answeredCount = 0;
            answersReviewContainer.innerHTML = '';

            shuffledQuizData.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                if (userAnswer === null) return;
                
                answeredCount++;
                let isCorrect = false;
                
                if (question.type === 'multiple-choice') {
                    isCorrect = userAnswer === question.answer;
                } else if (question.type === 'matching') {
                    let correctMatches = 0;
                    const totalMatches = Object.keys(question.pairs).length;
                    if(userAnswer && Object.keys(userAnswer).length > 0) {
                        for (const concept in userAnswer) {
                            if (question.pairs[concept] === userAnswer[concept]) correctMatches++;
                        }
                    }
                    isCorrect = correctMatches === totalMatches;
                }

                if (isCorrect) score++;

                const reviewHtml = `<div class="p-4 rounded-lg ${isCorrect ? 'bg-green-100 dark:bg-green-800/30' : 'bg-red-100 dark:bg-red-800/30'}"><p class="font-bold">${index + 1}. ${question.question} - ${isCorrect ? 'Correcto' : 'Incorrecto'}</p></div>`;
                answersReviewContainer.innerHTML += reviewHtml;
            });

            scoreContainer.innerHTML = `Tu puntaje: <span class="text-blue-500 dark:text-blue-400">${score}</span> de <span class="text-blue-500 dark:text-blue-400">${answeredCount}</span> respondidas.`;
            resultsModal.classList.remove('hidden');
            resultsModal.classList.add('flex');
        }

        prevBtn.addEventListener('click', () => { if (currentQuestionIndex > 0) { currentQuestionIndex--; renderQuestion(); } });
        nextBtn.addEventListener('click', () => { if (currentQuestionIndex < shuffledQuizData.length - 1) { currentQuestionIndex++; renderQuestion(); } });
        startBtn.addEventListener('click', () => { currentQuestionIndex = 0; renderQuestion(); });
        endBtn.addEventListener('click', () => { currentQuestionIndex = shuffledQuizData.length - 1; renderQuestion(); });
        submitBtn.addEventListener('click', showResults);
        restartBtn.addEventListener('click', startQuiz);

        startQuiz();
    </script>

</body>
</html>



